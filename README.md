# ëŒ€ê·œëª¨ íŠ¸ë˜í”½ ì„ ì°©ìˆœ í‹°ì¼“íŒ… ì‹œìŠ¤í…œ (Traffic Buster)

**ëŒ€ê·œëª¨ ìœ ì € ë™ì‹œ ì ‘ì†**ì„ ê°€ì •í•œ ê³ ì„±ëŠ¥ í‹°ì¼“íŒ… ì„œë¹„ìŠ¤ êµ¬ì¶• í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.  
ë™ì‹œì„± ì œì–´(Concurrency Control), ëŒ€ê¸°ì—´ ì‹œìŠ¤í…œ, ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ í†µí•´ **ë°ì´í„° ì •í•©ì„±**ê³¼ **ì‹œìŠ¤í…œ ì•ˆì •ì„±**ì„ í™•ë³´í•˜ëŠ” ê³¼ì •ì— ì§‘ì¤‘í–ˆìŠµë‹ˆë‹¤.

---

## ğŸ›  Tech Stack

- **Language**: Java 24, Kotlin 1.9
- **Framework**: Spring Boot 3.2.3
- **Database**: MySQL 8.0, Redis (Cache/Lock/Queue)
- **Message Queue**: Apache Kafka
- **Testing**: JUnit5, Testcontainers, k6 (Load Testing)
- **Infrastructure**: Docker, Docker Compose, Nginx

---

## ê¸°ìˆ ì  ë„ì „ê³¼ í•´ê²° ê³¼ì • (Problem & Solution)

### 1. ë™ì‹œì„± ë¬¸ì œ í•´ê²° (Concurrency Control)
**ìƒí™©**: ì¬ê³ ê°€ 100ê°œì¸ ìƒí’ˆì— ëŒ€í•´ 100ëª…ì´ ë™ì‹œì— ì£¼ë¬¸ ìš”ì²­.  
**ë¬¸ì œ**: Race Conditionìœ¼ë¡œ ì¸í•´ ì¬ê³ ê°€ 0ì´ ë˜ì§€ ì•Šê³  ë‚¨ëŠ” í˜„ìƒ ë°œìƒ (Lost Update).

| ì‹œë„ | ë°©ì‹ | ê²°ê³¼ ë° í•œê³„ |
|---|---|---|
| **1. ë‚™ê´€ì  ë½** | JPA `@Version` | ì¶©ëŒ ì‹œ ì¬ì‹œë„ ë¡œì§ í•„ìš”. ë¹ˆë²ˆí•œ ì¶©ëŒ ìƒí™©ì—ì„œ DB ë¶€í•˜ ê¸‰ì¦. |
| **2. ë¹„ê´€ì  ë½** | `SELECT ... FOR UPDATE` | ë°ì´í„° ì •í•©ì„±ì€ ë³´ì¥ë˜ë‚˜, ë½ ëŒ€ê¸°ë¡œ ì¸í•œ ì„±ëŠ¥ ì €í•˜ ë° ë°ë“œë½ ìœ„í—˜. |
| **3. ë¶„ì‚° ë½ (ì±„íƒ)** | **Redisson (Pub/Sub)** | ë‹¤ì¤‘ ì„œë²„ í™˜ê²½ì—ì„œë„ ë™ì‹œì„± ì œì–´ ê°€ëŠ¥. ìŠ¤í•€ ë½ ëŒ€ë¹„ Redis ë¶€í•˜ ì ìŒ. |

### 2. ì‹œìŠ¤í…œ ê³¼ë¶€í•˜ ë°©ì§€ (Queue System)
**ë¬¸ì œ**: ë¶„ì‚° ë½ì„ ì ìš©í•´ë„, ìˆ˜ë§Œ ëª…ì˜ ìš”ì²­ì´ ë™ì‹œì— DB/Redis ì»¤ë„¥ì…˜ì„ ì ìœ í•˜ë©´ ì‹œìŠ¤í…œ ë‹¤ìš´ ìœ„í—˜.  
**í•´ê²°**: **Redis Sorted Set**ì„ ì´ìš©í•œ ëŒ€ê¸°ì—´ ì‹œìŠ¤í…œ êµ¬í˜„.
- **ì§„ì… ì œì–´**: `Score`(íƒ€ì„ìŠ¤íƒ¬í”„) ê¸°ë°˜ìœ¼ë¡œ ë¨¼ì € ì˜¨ ìˆœì„œëŒ€ë¡œ ì¤„ì„ ì„¸ì›€.
- **ìœ ëŸ‰ ì œì–´ (Throttling)**: ìŠ¤ì¼€ì¤„ëŸ¬ê°€ 0.1ì´ˆë§ˆë‹¤ 50ëª…ì”©ë§Œ ì…ì¥ í† í°(`Active Token`)ì„ ë°œê¸‰.
- **ê²°ê³¼**: ë°±ì—”ë“œ ì‹œìŠ¤í…œì´ ê°ë‹¹ ê°€ëŠ¥í•œ ìˆ˜ì¤€ìœ¼ë¡œ íŠ¸ë˜í”½ì„ ì¼ì •í•˜ê²Œ ìœ ì§€.

### 3. ì²˜ë¦¬ëŸ‰ ê·¹ëŒ€í™” (Asynchronous Processing)
**ë¬¸ì œ**: ì£¼ë¬¸ ìš”ì²­ ì‹œ DB ì—…ë°ì´íŠ¸ê°€ ì™„ë£Œë  ë•Œê¹Œì§€ ì‚¬ìš©ìê°€ ê¸°ë‹¤ë ¤ì•¼ í•¨ (Blocking).  
**í•´ê²°**: **Apache Kafka**ë¥¼ ë„ì…í•˜ì—¬ ì£¼ë¬¸ ì²˜ë¦¬ë¥¼ ë¹„ë™ê¸°ë¡œ ì „í™˜.
- **Producer**: ì£¼ë¬¸ ìš”ì²­ì„ ë°›ìœ¼ë©´ Kafkaì— ë©”ì‹œì§€ ì „ì†¡ í›„ ì¦‰ì‹œ ì‘ë‹µ (Latency ìµœì†Œí™”).
- **Consumer**: ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë©”ì‹œì§€ë¥¼ ì†Œë¹„í•˜ì—¬ ì‹¤ì œ DB ì¬ê³  ì°¨ê° (ë¹„ê´€ì  ë½ ì ìš©).
- **ê²°ê³¼**: ì‚¬ìš©ì ì‘ë‹µ ì†ë„ íšê¸°ì  ê°œì„  ë° ì‹œìŠ¤í…œ ê²°í•©ë„ ê°ì†Œ.

---

## ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼ (Performance)

**í™˜ê²½**: Docker Compose (App x 2, Nginx, Redis, Kafka, MySQL)  
**ë„êµ¬**: k6  
**ì‹œë‚˜ë¦¬ì˜¤**: 100ëª…ì˜ ìœ ì €ê°€ ëŒ€ê¸°ì—´ ë“±ë¡ -> ëŒ€ê¸° -> ì£¼ë¬¸ ìš”ì²­

- **ê²°ê³¼**: 100ê±´ì˜ ìš”ì²­ì´ ëª¨ë‘ ì •ìƒ ì²˜ë¦¬ë˜ì—ˆìœ¼ë©°, ìµœì¢… ì¬ê³ ê°€ ì •í™•íˆ **0**ì´ ë¨ì„ ê²€ì¦.
- **ì•ˆì •ì„±**: ì¬ê³  ë¶€ì¡± ì‹œ `400 Bad Request`ë¥¼ ë°˜í™˜í•˜ë©° ìŒìˆ˜ ì¬ê³  ë°©ì§€ í™•ì¸.

---

## How to Run

### 1. Prerequisites
- Docker & Docker Compose
- Java 21+

### 2. Build & Run
```bash
# ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹Œë“œ
./gradlew clean build -x test

# ì „ì²´ ì¸í”„ë¼ ì‹¤í–‰ (MySQL, Redis, Kafka, Zookeeper, App x 2, Nginx)
docker-compose up --build -d
```

### 3. Load Test (k6)
```bash
# k6 ì„¤ì¹˜ (macOS)
brew install k6

# ë¶€í•˜ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
k6 run k6/load-test-queue.js
```

### 4. Monitoring & Verification
- **Kafka UI (AKHQ)**: [http://localhost:8081](http://localhost:8081)
- **DB ë°ì´í„° í™•ì¸**:
```bash
docker exec -it traffic-buster-db mysql -u root -p -e "USE market_db; SELECT * FROM concerts;"
```
